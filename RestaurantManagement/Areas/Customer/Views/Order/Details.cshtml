@model RestaurantManagement.Models.Order
@using RestaurantManagement.Models

@{
    ViewData["Title"] = "Chi tiết đơn hàng";
    Layout = "~/Areas/Customer/Views/Shared/_CustomerLayout.cshtml";
    var feedback = ViewBag.Feedback as Feedback;
}

<div class="container mt-4">
    <h2 class="fw-bold mb-4"><i class="bi bi-receipt me-2"></i>Chi tiết đơn hàng #@Model.OrderId</h2>

    <div class="mb-3">
        <strong>Bàn:</strong> @Model.DingningTable?.Name<br />
        <strong>Thời gian:</strong> @Model.OrderTime.ToString("dd/MM/yyyy HH:mm")<br />
        <strong>Trạng thái:</strong> <span class="badge bg-info text-dark">@Model.Status</span>
    </div>

    <h5 class="mt-4">🧾 Danh sách món</h5>
    <table class="table table-bordered rounded-3">
        <thead class="table-light">
            <tr>
                <th>Món ăn</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Thành tiền</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.OrderItems)
            {
                <tr>
                    <td>@item.MenuItem?.Name</td>
                    <td>@item.Quantity</td>
                    <td>@($"{item.MenuItem?.Price:N0} đ")</td>
                    <td>@($"{item.Quantity * (item.MenuItem?.Price ?? 0):N0} đ")</td>
                </tr>
            }
        </tbody>
    </table>

    <h5 class="mt-4">💰 Thanh toán</h5>
    <p>
        <strong>Tổng tiền:</strong> @($"{Model.Payment?.TotalAmount.ToString("N0")} đ")<br />
        <strong>Phương thức:</strong> @Model.Payment?.Method
    </p>

    <h5 class="mt-4">📝 Phản hồi</h5>
    @if (feedback != null)
    {
        <p><strong>Nội dung:</strong> @feedback.Content</p>

        @if (feedback.Reply != null)
        {
            <p class="text-success"><strong>Phản hồi từ nhà hàng:</strong> @feedback.Reply.Content</p>
        }
        else
        {
            <a asp-area="Customer" asp-controller="Feedback" asp-action="Edit" asp-route-id="@feedback.FeedbackId" class="btn btn-outline-warning me-2">
                <i class="bi bi-pencil-square me-1"></i>Sửa phản hồi
            </a>
            <form asp-area="Customer" asp-controller="Feedback" asp-action="Delete" asp-route-id="@feedback.FeedbackId" method="post" class="d-inline" onsubmit="return confirm('Xác nhận xoá phản hồi này?')">
                <button type="submit" class="btn btn-outline-danger">
                    <i class="bi bi-trash-fill me-1"></i>Xoá phản hồi
                </button>
            </form>
        }
    }
    else
    {
        <a asp-area="Customer" asp-controller="Feedback" asp-action="Create" asp-route-orderId="@Model.OrderId" class="btn btn-outline-primary">
            <i class="bi bi-chat-square-text me-1"></i>Gửi phản hồi
        </a>

        <a asp-area="Customer" asp-controller="Feedback" asp-action="Create" asp-route-orderId="@Model.OrderId" class="btn btn-outline-primary">
            <i class="bi bi-chat-square-text me-1"></i>Gửi phản hồi
        </a>

    }
</div>
